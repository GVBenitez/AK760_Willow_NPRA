```{r}

library(tidyr)
library(ggplot2)
library(readr)
library(dplyr)
library(tidyverse)
library(lubridate)

df1 <- read_delim("_book/dailyPrecip.csv", delim = "|")

data <- df1

data <- data %>%
  rename(Year = "Water Year")

data_long <- data %>%
  pivot_longer(cols = -c(Year, Day),
               names_to = "Month",
               values_to = "Precip")

month_order <- c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")

data_long <- data_long %>%
  mutate(
    Month = factor(Month, levels = month_order, ordered = TRUE),
    Date = as.Date(paste("2000", Month, Day, sep = "-"), format = "%Y-%b-%d")
  )

ggplot(data_long, aes(x = Date, y = Precip)) +
  geom_line()


# Calculate the average temperature for each day across all years
avg_precip <- data_long %>%
  group_by(Date) %>%
  summarise(Avgprecip = mean(Precip, na.rm = TRUE))

# Create the combined line graph
ggplot() +
  # Individual year lines
  geom_line(data = data_long, 
            aes(x = Date, y = Precip), 
            alpha = 0.5) +
  # Average temperature line
  geom_line(data = avg_precip, 
            aes(x = Date, y = Avgprecip),
            color = "black", size = 1.2) +
  scale_x_date(date_labels = "%b", date_breaks = "1 month") +
  scale_color_viridis_d(option = "plasma") +  # Color-blind friendly palette
  labs(title = "Average Daily Precipitation 2004-2024",
       x = "Month",
       y = "Precipitation (Inches)")
       color = "Water Year"

```