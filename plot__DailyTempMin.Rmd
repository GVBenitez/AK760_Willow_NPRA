library(tidyr)
library(ggplot2)
library(readr)
library(dplyr)
library(tidyverse)
library(lubridate)

df1 <- read_delim("_book/dailyMinTemp.csv", delim = "|")

data <- df1

data_long <- data %>%
  pivot_longer(cols = -c(`Water Year`, Day),
               names_to = "Month",
               values_to = "Temperature")

month_order <- c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")
data_long <- data_long %>%
  mutate(
    Month = factor(Month, levels = month_order, ordered = TRUE),
    Date = as.Date(paste("2000", Month, Day, sep = "-"), format = "%Y-%b-%d")
  )

# Calculate the average temperature for each day across all years
avg_temp <- data_long %>%
  group_by(Date) %>%
  summarise(AvgTemperature = mean(Temperature, na.rm = TRUE))

# Create the combined line graph
ggplot() +
  # Individual year lines
  geom_line(data = data_long, 
            aes(x = Date, y = Temperature), 
            alpha = 0.5) +
  # Average temperature line
  geom_line(data = avg_temp, 
            aes(x = Date, y = AvgTemperature),
            color = "black", size = 1.2) +
  scale_x_date(date_labels = "%b", date_breaks = "1 month") +
  scale_color_viridis_d(option = "plasma") +  # Color-blind friendly palette
  labs(title = "Minimum Daily Temperature 2004-2024",
       x = "Month",
       y = "Temperature (Fahrenheit)")
       color = "Water Year"

